<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: 'Segoe UI', Tahoma, Arial, sans-serif;
      background: linear-gradient(135deg, #0b132b 0%, #090f2c 100%);
      color: #e8f4ff;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      padding: 30px 15px;
      background: rgba(255,255,255,0.03);
      border-radius: 16px;
      margin-bottom: 30px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.7);
    }

    .header h1 {
      color: #4ac1ff;
      font-size: 32px;
      margin-bottom: 10px;
    }

    .nav {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }

    .nav-btn {
      padding: 12px 24px;
      background: #4ac1ff;
      color: #042028;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: bold;
      font-size: 16px;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(74, 193, 255, 0.3);
    }

    .nav-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(74, 193, 255, 0.5);
    }

    .nav-btn.secondary {
      background: transparent;
      border: 2px solid #4ac1ff;
      color: #4ac1ff;
    }

    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.7);
      margin-bottom: 20px;
      position: relative;
    }

    .logo-corner {
      position: fixed;
      top: 20px;
      left: 20px;
      width: 80px;
      height: 80px;
      background: #4ac1ff;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 20px rgba(74, 193, 255, 0.4);
      z-index: 1000;
      font-size: 36px;
      color: #042028;
      font-weight: bold;
    }

    .logo-corner:hover {
      transform: scale(1.1) rotate(5deg);
      box-shadow: 0 6px 30px rgba(74, 193, 255, 0.6);
    }

    .logo-corner::after {
      content: 'ğŸ ';
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 2000;
      align-items: center;
      justify-content: center;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: linear-gradient(180deg, #1c2541, #0b132b);
      padding: 40px;
      border-radius: 20px;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 10px 50px rgba(0,0,0,0.9);
      border: 2px solid rgba(74, 193, 255, 0.3);
      animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
      from {
        transform: translateY(-50px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .modal-header {
      text-align: center;
      margin-bottom: 30px;
    }

    .modal-header h2 {
      color: #4ac1ff;
      font-size: 24px;
      margin-bottom: 10px;
    }

    .modal-header p {
      color: #a1b2c3;
      font-size: 14px;
    }

    .password-input-group {
      margin-bottom: 25px;
    }

    .password-input-group input {
      width: 100%;
      padding: 15px;
      border-radius: 12px;
      border: 2px solid rgba(255,255,255,0.1);
      background: rgba(255,255,255,0.05);
      color: #e8f4ff;
      font-size: 18px;
      text-align: center;
      letter-spacing: 3px;
      transition: all 0.3s;
    }

    .password-input-group input:focus {
      outline: none;
      border-color: #4ac1ff;
      box-shadow: 0 0 20px rgba(74, 193, 255, 0.3);
    }

    .modal-buttons {
      display: flex;
      gap: 15px;
    }

    .modal-btn {
      flex: 1;
      padding: 14px;
      border: none;
      border-radius: 12px;
      font-weight: bold;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .modal-btn.confirm {
      background: #4ac1ff;
      color: #042028;
    }

    .modal-btn.confirm:hover {
      background: #79d4ff;
      transform: translateY(-2px);
    }

    .modal-btn.cancel {
      background: transparent;
      border: 2px solid rgba(255,255,255,0.2);
      color: #a1b2c3;
    }

    .modal-btn.cancel:hover {
      background: rgba(255,255,255,0.05);
    }

    .error-message {
      color: #ff4a4a;
      text-align: center;
      margin-top: 15px;
      font-size: 14px;
      display: none;
    }

    .error-message.show {
      display: block;
      animation: shake 0.5s;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }

    .loading {
      display: none;
      text-align: center;
      padding: 40px;
      color: #4ac1ff;
    }

    .loading.show {
      display: block;
    }

    .spinner {
      border: 4px solid rgba(74, 193, 255, 0.1);
      border-top: 4px solid #4ac1ff;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #a1b2c3;
      font-size: 14px;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.1);
      background: rgba(255,255,255,0.05);
      color: #e8f4ff;
      font-size: 16px;
    }

    .form-group select option {
      background: #1c2541;
      color: #e8f4ff;
    }

    .btn {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 12px;
      background: #4ac1ff;
      color: #042028;
      font-weight: bold;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s;
      margin-top: 10px;
    }

    .btn:hover {
      background: #79d4ff;
      transform: translateY(-2px);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .table-wrapper {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th, td {
      padding: 15px;
      text-align: right;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    th {
      background: rgba(74, 193, 255, 0.1);
      color: #4ac1ff;
      font-weight: bold;
    }

    tr:hover {
      background: rgba(255,255,255,0.03);
    }

    .delete-btn {
      background: #ff4a4a;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
    }

    .delete-btn:hover {
      background: #ff6b6b;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #a1b2c3;
      font-size: 18px;
    }

    .empty-state-icon {
      font-size: 64px;
      margin-bottom: 20px;
      opacity: 0.3;
    }

    .page {
      display: none;
    }

    .page.active {
      display: block;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: rgba(74, 193, 255, 0.1);
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      border: 1px solid rgba(74, 193, 255, 0.2);
    }

    .stat-number {
      font-size: 36px;
      font-weight: bold;
      color: #4ac1ff;
      margin-bottom: 5px;
    }

    .stat-label {
      color: #a1b2c3;
      font-size: 14px;
    }

    .connection-status {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 10px 20px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
      z-index: 999;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .connection-status.connected {
      background: rgba(74, 193, 255, 0.2);
      color: #4ac1ff;
      border: 1px solid #4ac1ff;
    }

    .filter-section {
      background: rgba(74, 193, 255, 0.05);
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      border: 1px solid rgba(74, 193, 255, 0.1);
    }

    .filter-title {
      color: #4ac1ff;
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .filter-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }

    .filter-input {
      padding: 10px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.1);
      background: rgba(255,255,255,0.05);
      color: #e8f4ff;
      font-size: 14px;
    }

    .filter-input:focus {
      outline: none;
      border-color: #4ac1ff;
      box-shadow: 0 0 10px rgba(74, 193, 255, 0.2);
    }

    .filter-buttons {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .filter-btn {
      padding: 8px 16px;
      border-radius: 8px;
      border: none;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: bold;
    }

    .filter-btn.search {
      background: #4ac1ff;
      color: #042028;
    }

    .filter-btn.search:hover {
      background: #79d4ff;
    }

    .filter-btn.reset {
      background: transparent;
      border: 1px solid rgba(255,255,255,0.2);
      color: #a1b2c3;
    }

    .filter-btn.reset:hover {
      background: rgba(255,255,255,0.05);
    }

    .results-count {
      color: #a1b2c3;
      font-size: 14px;
      margin-bottom: 10px;
      padding: 10px;
      background: rgba(74, 193, 255, 0.05);
      border-radius: 8px;
      text-align: center;
    }

    .results-count strong {
      color: #4ac1ff;
      font-size: 16px;
    }

    @media (max-width: 768px) {
      .logo-corner {
        width: 60px;
        height: 60px;
        font-size: 24px;
      }
      
      .header h1 {
        font-size: 24px;
      }
      
      table {
        font-size: 14px;
      }
      
      th, td {
        padding: 10px 5px;
      }

      .modal-content {
        padding: 30px 20px;
      }

      .connection-status {
        top: 10px;
        right: 10px;
        font-size: 10px;
        padding: 8px 12px;
      }
    }
  </style>
</head>
<body>
  <div class="connection-status connected" id="connectionStatus">
    <span id="statusIcon">â—</span>
    <span id="statusText">Ù…ØªØµÙ„ Ø¨Ù€ Firebase</span>
  </div>

  <div class="modal" id="passwordModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ğŸ”’ Ù…Ù†Ø·Ù‚Ø© Ù…Ø­Ù…ÙŠØ©</h2>
        <p>Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„Ø¯Ø®ÙˆÙ„</p>
      </div>
      <form onsubmit="event.preventDefault(); checkPassword();">
        <div class="password-input-group">
          <input type="password" id="passwordInput" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" maxlength="20">
        </div>
        <div class="modal-buttons">
          <button type="submit" class="modal-btn confirm">âœ“ ØªØ£ÙƒÙŠØ¯</button>
          <button type="button" class="modal-btn cancel" onclick="closePasswordModal()">âœ— Ø¥Ù„ØºØ§Ø¡</button>
        </div>
      </form>
      <div class="error-message" id="errorMessage">âš ï¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!</div>
    </div>
  </div>

  <div class="logo-corner" onclick="goBackToIndex()" title="Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©"></div>

  <div class="container">
    <div class="header">
      <h1>ğŸ† Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†</h1>
      <p style="color: #a1b2c3; margin-top: 10px;">Ù„Ø¬Ù†Ø© Ø§Ù„Ø£Ù†Ø´Ø·Ø© ÙˆØ§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª</p>
    </div>

    <div class="nav">
      <button class="nav-btn" onclick="showPage('register')">â• ØªØ³Ø¬ÙŠÙ„ Ù…Ø´Ø±Ù Ø¬Ø¯ÙŠØ¯</button>
      <button class="nav-btn secondary" onclick="showPage('view')">ğŸ‘ï¸ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</button>
      <button class="nav-btn secondary" onclick="requestPasswordForList()">ğŸ”’ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</button>
      <button class="nav-btn secondary" onclick="showPage('home')">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    </div>

    <div id="homePage" class="page active">
      <div class="stats">
        <div class="stat-card">
          <div class="stat-number" id="totalCount">0</div>
          <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="todayCount">0</div>
          <div class="stat-label">Ù…Ø³Ø¬Ù„ Ø§Ù„ÙŠÙˆÙ…</div>
        </div>
      </div>

      <div class="card">
        <h2 style="color: #4ac1ff; margin-bottom: 20px; text-align: center;">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†</h2>
        <p style="text-align: center; color: #a1b2c3; line-height: 1.8; font-size: 16px;">
          Ù…Ù† Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ ØªØ³Ø¬ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯ ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ø³Ø¬Ù„Ø§ØªÙ‡Ù….<br>
          Ø§Ù„Ù†Ø¸Ø§Ù… Ù…ØªØµÙ„ Ø¨Ù€ <strong style="color: #4ac1ff;">Firebase Firestore</strong> Ù„Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù† Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø­Ø§Ø¨Ø© â˜ï¸
        </p>
      </div>
    </div>

    <div id="registerPage" class="page">
      <div class="card">
        <h2 style="color: #4ac1ff; margin-bottom: 25px; text-align: center;">ğŸ“ ØªØ³Ø¬ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±Ù</h2>
        
        <form id="supervisorForm">
          <div class="form-group">
            <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±Ù *</label>
            <input type="text" id="supervisorName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" required>
          </div>

          <div class="form-group">
            <label>Ø§Ù„Ø³Ù† *</label>
            <input type="number" id="supervisorAge" min="18" max="80" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù…Ø±" required>
          </div>

          <div class="form-group">
            <label>Ø§Ù„ÙƒÙ†ÙŠØ³Ø© *</label>
            <input type="text" id="supervisorChurch" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ÙƒÙ†ÙŠØ³Ø©" required>
          </div>

          <div class="form-group">
            <label>Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù†Ù‡Ø§ *</label>
            <select id="supervisorGame" required>
              <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù„Ø¹Ø¨Ø© --</option>
              <option value="ÙƒØ±Ø© Ø§Ù„Ù‚Ø¯Ù…">âš½ ÙƒØ±Ø© Ø§Ù„Ù‚Ø¯Ù…</option>
              <option value="Ø§Ù„Ø¨Ù†Ø¬ Ø¨ÙˆÙ†Ø¬">ğŸ“ Ø§Ù„Ø¨Ù†Ø¬ Ø¨ÙˆÙ†Ø¬</option>
              <option value="Ø§Ù„Ø´Ø·Ø±Ù†Ø¬">â™Ÿï¸ Ø§Ù„Ø´Ø·Ø±Ù†Ø¬</option>
            </select>
          </div>

          <div class="form-group">
            <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
            <input type="tel" id="supervisorPhone" placeholder="01xxxxxxxxx">
          </div>

          <button type="submit" class="btn" id="submitBtn">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        </form>
      </div>
    </div>

    <div id="listPage" class="page">
      <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
          <h2 style="color: #4ac1ff; margin: 0;">ğŸ“‹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†</h2>
          <button class="delete-btn" onclick="clearAllData()" style="width: auto;">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</button>
        </div>

        <div class="filter-section">
          <div class="filter-title">
            ğŸ” Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ©
          </div>
          <div class="filter-grid">
            <input type="text" id="filterName" class="filter-input" placeholder="Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…">
            <input type="text" id="filterChurch" class="filter-input" placeholder="Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„ÙƒÙ†ÙŠØ³Ø©">
            <select id="filterGame" class="filter-input">
              <option value="">ÙƒÙ„ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</option>
              <option value="ÙƒØ±Ø© Ø§Ù„Ù‚Ø¯Ù…">âš½ ÙƒØ±Ø© Ø§Ù„Ù‚Ø¯Ù…</option>
              <option value="Ø§Ù„Ø¨Ù†Ø¬ Ø¨ÙˆÙ†Ø¬">ğŸ“ Ø§Ù„Ø¨Ù†Ø¬ Ø¨ÙˆÙ†Ø¬</option>
              <option value="Ø§Ù„Ø´Ø·Ø±Ù†Ø¬">â™Ÿï¸ Ø§Ù„Ø´Ø·Ø±Ù†Ø¬</option>
            </select>
            <input type="tel" id="filterPhone" class="filter-input" placeholder="Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ù‡Ø§ØªÙ">
          </div>
          <div class="filter-buttons">
            <button class="filter-btn search" onclick="applyFilter()">ğŸ” Ø¨Ø­Ø«</button>
            <button class="filter-btn reset" onclick="resetFilter()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
          </div>
        </div>

        <div class="results-count" id="resultsCount" style="display: none;"></div>

        <div class="loading" id="loadingIndicator">
          <div class="spinner"></div>
          <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
        </div>

        <div id="supervisorsList"></div>
      </div>
    </div>

    <div id="viewPage" class="page">
      <div class="card">
        <div style="margin-bottom: 20px;">
          <h2 style="color: #4ac1ff; margin: 0;">ğŸ‘ï¸ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</h2>
          <p style="color: #a1b2c3; margin-top: 10px; font-size: 14px;">Ø¹Ø±Ø¶ ÙÙ‚Ø· - Ø¨Ø¯ÙˆÙ† ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø£Ùˆ Ø§Ù„Ø­Ø°Ù</p>
        </div>

        <div class="filter-section">
          <div class="filter-title">
            ğŸ” Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ©
          </div>
          <div class="filter-grid">
            <input type="text" id="filterNameView" class="filter-input" placeholder="Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…">
            <input type="text" id="filterChurchView" class="filter-input" placeholder="Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„ÙƒÙ†ÙŠØ³Ø©">
            <select id="filterGameView" class="filter-input">
              <option value="">ÙƒÙ„ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</option>
              <option value="ÙƒØ±Ø© Ø§Ù„Ù‚Ø¯Ù…">âš½ ÙƒØ±Ø© Ø§Ù„Ù‚Ø¯Ù…</option>
              <option value="Ø§Ù„Ø¨Ù†Ø¬ Ø¨ÙˆÙ†Ø¬">ğŸ“ Ø§Ù„Ø¨Ù†Ø¬ Ø¨ÙˆÙ†Ø¬</option>
              <option value="Ø§Ù„Ø´Ø·Ø±Ù†Ø¬">â™Ÿï¸ Ø§Ù„Ø´Ø·Ø±Ù†Ø¬</option>
            </select>
            <input type="tel" id="filterPhoneView" class="filter-input" placeholder="Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ù‡Ø§ØªÙ">
          </div>
          <div class="filter-buttons">
            <button class="filter-btn search" onclick="applyFilterView()">ğŸ” Ø¨Ø­Ø«</button>
            <button class="filter-btn reset" onclick="resetFilterView()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
          </div>
        </div>

        <div class="results-count" id="resultsCountView" style="display: none;"></div>

        <div class="loading" id="loadingIndicatorView">
          <div class="spinner"></div>
          <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
        </div>

        <div id="supervisorsViewList"></div>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, orderBy, Timestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyCHpkIlf8A13cL6TLggr7-3u8FM-PxzfSY",
      authDomain: "activitiescommittee-5b22c.firebaseapp.com",
      projectId: "activitiescommittee-5b22c",
      storageBucket: "activitiescommittee-5b22c.appspot.com",
      messagingSenderId: "378991885059",
      appId: "1:378991885059:web:d8db039a6fc569fffb8736"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const statusEl = document.getElementById('connectionStatus');
    const statusIcon = document.getElementById('statusIcon');
    const statusText = document.getElementById('statusText');
    
    statusEl.classList.add('connected');
    statusIcon.textContent = 'â—';
    statusText.textContent = 'Ù…ØªØµÙ„ Ø¨Ù€ Firebase';

    window.db = db;
    window.addDoc = addDoc;
    window.getDocs = getDocs;
    window.deleteDoc = deleteDoc;
    window.doc = doc;
    window.collection = collection;
    window.query = query;
    window.orderBy = orderBy;
    window.Timestamp = Timestamp;

    console.log('ğŸ”¥ Firebase initialized successfully!');
  </script>

  <script>
    const CORRECT_PASSWORD = 'admin123';

    function requestPasswordForList() {
      const modal = document.getElementById('passwordModal');
      const input = document.getElementById('passwordInput');
      const errorMsg = document.getElementById('errorMessage');
      
      modal.classList.add('active');
      input.value = '';
      errorMsg.classList.remove('show');
      
      setTimeout(() => input.focus(), 300);
    }

    function checkPassword() {
      const input = document.getElementById('passwordInput');
      const errorMsg = document.getElementById('errorMessage');
      
      if (input.value === CORRECT_PASSWORD) {
        closePasswordModal();
        showPage('list');
      } else {
        errorMsg.classList.add('show');
        input.value = '';
        input.focus();
        
        setTimeout(() => {
          errorMsg.classList.remove('show');
        }, 3000);
      }
    }

    function closePasswordModal() {
      const modal = document.getElementById('passwordModal');
      modal.classList.remove('active');
    }

    document.getElementById('passwordModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closePasswordModal();
      }
    });

    function showPage(pageName) {
      document.querySelectorAll('.page').forEach(page => {
        page.classList.remove('active');
      });
      
      if (pageName === 'home') {
        document.getElementById('homePage').classList.add('active');
        updateStats();
      } else if (pageName === 'register') {
        document.getElementById('registerPage').classList.add('active');
      } else if (pageName === 'list') {
        document.getElementById('listPage').classList.add('active');
        displaySupervisors();
      } else if (pageName === 'view') {
        document.getElementById('viewPage').classList.add('active');
        displaySupervisorsViewOnly();
      }
    }

    async function updateStats() {
      try {
        const q = query(collection(window.db, 'supervisors'), orderBy('createdAt', 'desc'));
        const snapshot = await getDocs(q);
        
        document.getElementById('totalCount').textContent = snapshot.size;
        
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        let todayCount = 0;
        snapshot.forEach(doc => {
          const data = doc.data();
          const docDate = data.createdAt.toDate();
          docDate.setHours(0, 0, 0, 0);
          if (docDate.getTime() === today.getTime()) {
            todayCount++;
          }
        });
        
        document.getElementById('todayCount').textContent = todayCount;
      } catch (error) {
        console.error('Error updating stats:', error);
      }
    }

    document.getElementById('supervisorForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const submitBtn = document.getElementById('submitBtn');
      const name = document.getElementById('supervisorName').value.trim();
      const age = document.getElementById('supervisorAge').value;
      const church = document.getElementById('supervisorChurch').value.trim();
      const game = document.getElementById('supervisorGame').value;
      const phone = document.getElementById('supervisorPhone').value.trim();

      if (!game) {
        alert('âš ï¸ Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ± Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù†Ù‡Ø§');
        return;
      }

      try {
        submitBtn.disabled = true;
        submitBtn.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';

        await addDoc(collection(window.db, 'supervisors'), {
          name: name,
          age: parseInt(age),
          church: church,
          game: game,
          phone: phone || '',
          createdAt: Timestamp.now()
        });

        alert('âœ… ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±Ù Ø¨Ù†Ø¬Ø§Ø­!');
        document.getElementById('supervisorForm').reset();
        showPage('home');
        
      } catch (error) {
        console.error('Error saving supervisor:', error);
        alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸: ' + error.message);
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
      }
    });

    async function displaySupervisors() {
      const listContainer = document.getElementById('supervisorsList');
      const loadingIndicator = document.getElementById('loadingIndicator');
      const resultsCount = document.getElementById('resultsCount');
      
      try {
        loadingIndicator.classList.add('show');
        listContainer.innerHTML = '';

        const q = query(collection(window.db, 'supervisors'), orderBy('createdAt', 'desc'));
        const snapshot = await getDocs(q);

        loadingIndicator.classList.remove('show');

        if (snapshot.empty) {
          resultsCount.style.display = 'none';
          listContainer.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon">ğŸ”­</div>
              <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ø¨Ø¹Ø¯</p>
              <p style="font-size: 14px; margin-top: 10px;">Ù‚Ù… Ø¨ØªØ³Ø¬ÙŠÙ„ Ù…Ø´Ø±Ù Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø¨Ø¯Ø¡</p>
            </div>
          `;
          return;
        }

        const filterName = (document.getElementById('filterName')?.value || '').toLowerCase().trim();
        const filterChurch = (document.getElementById('filterChurch')?.value || '').toLowerCase().trim();
        const filterGame = document.getElementById('filterGame')?.value || '';
        const filterPhone = (document.getElementById('filterPhone')?.value || '').trim();

        let filteredData = [];
        snapshot.forEach(docSnapshot => {
          const data = docSnapshot.data();
          
          if (filterName && !data.name.toLowerCase().includes(filterName)) return;
          if (filterChurch && !data.church.toLowerCase().includes(filterChurch)) return;
          if (filterGame && data.game !== filterGame) return;
          if (filterPhone && !(data.phone || '').includes(filterPhone)) return;
          
          filteredData.push({ id: docSnapshot.id, data: data });
        });

        if (filteredData.length === 0) {
          resultsCount.style.display = 'none';
          listContainer.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon">ğŸ”</div>
              <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¨Ø­Ø«</p>
              <p style="font-size: 14px; margin-top: 10px;">Ø¬Ø±Ø¨ ØªØºÙŠÙŠØ± Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø«</p>
            </div>
          `;
          return;
        }

        const hasFilters = filterName || filterChurch || filterGame || filterPhone;
        if (hasFilters) {
          resultsCount.style.display = 'block';
          resultsCount.innerHTML = `ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ <strong>${filteredData.length}</strong> Ù†ØªÙŠØ¬Ø© Ù…Ù† Ø£ØµÙ„ <strong>${snapshot.size}</strong> Ø³Ø¬Ù„`;
        } else {
          resultsCount.style.display = 'none';
        }

        let tableHTML = `
          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>Ø§Ù„Ø§Ø³Ù…</th>
                  <th>Ø§Ù„Ø³Ù†</th>
                  <th>Ø§Ù„ÙƒÙ†ÙŠØ³Ø©</th>
                  <th>Ø§Ù„Ù„Ø¹Ø¨Ø©</th>
                  <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                  <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th>
                  <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
              </thead>
              <tbody>
        `;

        filteredData.forEach(item => {
          const data = item.data;
          const date = data.createdAt.toDate();
          const formattedDate = date.toLocaleDateString('ar-EG', {
            year: 'numeric',
            month: 'short',
            day: 'numeric'
          });
          const formattedTime = date.toLocaleTimeString('ar-EG', {
            hour: '2-digit',
            minute: '2-digit'
          });

          let gameIcon = '';
          if (data.game === 'ÙƒØ±Ø© Ø§Ù„Ù‚Ø¯Ù…') gameIcon = 'âš½';
          else if (data.game === 'Ø§Ù„Ø¨Ù†Ø¬ Ø¨ÙˆÙ†Ø¬') gameIcon = 'ğŸ“';
          else if (data.game === 'Ø§Ù„Ø´Ø·Ø±Ù†Ø¬') gameIcon = 'â™Ÿï¸';

          tableHTML += `
            <tr>
              <td><strong>${data.name}</strong></td>
              <td>${data.age} Ø³Ù†Ø©</td>
              <td>${data.church}</td>
              <td><span style="font-size: 20px;">${gameIcon}</span> ${data.game}</td>
              <td>${data.phone || '-'}</td>
              <td>${formattedDate}<br><small style="color: #a1b2c3;">${formattedTime}</small></td>
              <td>
                <button class="delete-btn" onclick="deleteSupervisor('${item.id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
              </td>
            </tr>
          `;
        });

        tableHTML += `
              </tbody>
            </table>
          </div>
        `;

        listContainer.innerHTML = tableHTML;
        
      } catch (error) {
        console.error('Error displaying supervisors:', error);
        loadingIndicator.classList.remove('show');
        listContainer.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">âš ï¸</div>
            <p style="color: #ff4a4a;">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
            <p style="font-size: 14px; margin-top: 10px;">${error.message}</p>
          </div>
        `;
      }
    }

    async function displaySupervisorsViewOnly() {
      const listContainer = document.getElementById('supervisorsViewList');
      const loadingIndicator = document.getElementById('loadingIndicatorView');
      const resultsCount = document.getElementById('resultsCountView');
      
      try {
        loadingIndicator.classList.add('show');
        listContainer.innerHTML = '';

        const q = query(collection(window.db, 'supervisors'), orderBy('createdAt', 'desc'));
        const snapshot = await getDocs(q);

        loadingIndicator.classList.remove('show');

        if (snapshot.empty) {
          resultsCount.style.display = 'none';
          listContainer.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon">ğŸ”­</div>
              <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ø¨Ø¹Ø¯</p>
              <p style="font-size: 14px; margin-top: 10px;">Ù‚Ù… Ø¨ØªØ³Ø¬ÙŠÙ„ Ù…Ø´Ø±Ù Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø¨Ø¯Ø¡</p>
            </div>
          `;
          return;
        }

        const filterName = (document.getElementById('filterNameView')?.value || '').toLowerCase().trim();
        const filterChurch = (document.getElementById('filterChurchView')?.value || '').toLowerCase().trim();
        const filterGame = document.getElementById('filterGameView')?.value || '';
        const filterPhone = (document.getElementById('filterPhoneView')?.value || '').trim();

        let filteredData = [];
        snapshot.forEach(docSnapshot => {
          const data = docSnapshot.data();
          
          if (filterName && !data.name.toLowerCase().includes(filterName)) return;
          if (filterChurch && !data.church.toLowerCase().includes(filterChurch)) return;
          if (filterGame && data.game !== filterGame) return;
          if (filterPhone && !(data.phone || '').includes(filterPhone)) return;
          
          filteredData.push({ id: docSnapshot.id, data: data });
        });

        if (filteredData.length === 0) {
          resultsCount.style.display = 'none';
          listContainer.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon">ğŸ”</div>
              <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¨Ø­Ø«</p>
              <p style="font-size: 14px; margin-top: 10px;">Ø¬Ø±Ø¨ ØªØºÙŠÙŠØ± Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø«</p>
            </div>
          `;
          return;
        }

        const hasFilters = filterName || filterChurch || filterGame || filterPhone;
        if (hasFilters) {
          resultsCount.style.display = 'block';
          resultsCount.innerHTML = `ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ <strong>${filteredData.length}</strong> Ù†ØªÙŠØ¬Ø© Ù…Ù† Ø£ØµÙ„ <strong>${snapshot.size}</strong> Ø³Ø¬Ù„`;
        } else {
          resultsCount.style.display = 'none';
        }

        let tableHTML = `
          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>Ø§Ù„Ø§Ø³Ù…</th>
                  <th>Ø§Ù„Ø³Ù†</th>
                  <th>Ø§Ù„ÙƒÙ†ÙŠØ³Ø©</th>
                  <th>Ø§Ù„Ù„Ø¹Ø¨Ø©</th>
                  <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                  <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th>
                </tr>
              </thead>
              <tbody>
        `;

        filteredData.forEach(item => {
          const data = item.data;
          const date = data.createdAt.toDate();
          const formattedDate = date.toLocaleDateString('ar-EG', {
            year: 'numeric',
            month: 'short',
            day: 'numeric'
          });
          const formattedTime = date.toLocaleTimeString('ar-EG', {
            hour: '2-digit',
            minute: '2-digit'
          });

          let gameIcon = '';
          if (data.game === 'ÙƒØ±Ø© Ø§Ù„Ù‚Ø¯Ù…') gameIcon = 'âš½';
          else if (data.game === 'Ø§Ù„Ø¨Ù†Ø¬ Ø¨ÙˆÙ†Ø¬') gameIcon = 'ğŸ“';
          else if (data.game === 'Ø§Ù„Ø´Ø·Ø±Ù†Ø¬') gameIcon = 'â™Ÿï¸';

          tableHTML += `
            <tr>
              <td><strong>${data.name}</strong></td>
              <td>${data.age} Ø³Ù†Ø©</td>
              <td>${data.church}</td>
              <td><span style="font-size: 20px;">${gameIcon}</span> ${data.game}</td>
              <td>${data.phone || '-'}</td>
              <td>${formattedDate}<br><small style="color: #a1b2c3;">${formattedTime}</small></td>
            </tr>
          `;
        });

        tableHTML += `
              </tbody>
            </table>
          </div>
        `;

        listContainer.innerHTML = tableHTML;
        
      } catch (error) {
        console.error('Error displaying supervisors:', error);
        loadingIndicator.classList.remove('show');
        listContainer.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">âš ï¸</div>
            <p style="color: #ff4a4a;">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
            <p style="font-size: 14px; margin-top: 10px;">${error.message}</p>
          </div>
        `;
      }
    }

    function applyFilter() {
      displaySupervisors();
    }

    function resetFilter() {
      document.getElementById('filterName').value = '';
      document.getElementById('filterChurch').value = '';
      document.getElementById('filterGame').value = '';
      document.getElementById('filterPhone').value = '';
      displaySupervisors();
    }

    function applyFilterView() {
      displaySupervisorsViewOnly();
    }

    function resetFilterView() {
      document.getElementById('filterNameView').value = '';
      document.getElementById('filterChurchView').value = '';
      document.getElementById('filterGameView').value = '';
      document.getElementById('filterPhoneView').value = '';
      displaySupervisorsViewOnly();
    }

    async function deleteSupervisor(id) {
      if (!confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±ÙØŸ')) {
        return;
      }

      try {
        await deleteDoc(doc(window.db, 'supervisors', id));
        alert('âœ… ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­');
        displaySupervisors();
        updateStats();
      } catch (error) {
        console.error('Error deleting supervisor:', error);
        alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù: ' + error.message);
      }
    }

    async function clearAllData() {
      if (!confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§ØªØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!')) {
        return;
      }

      if (!confirm('âš ï¸âš ï¸ ØªØ£ÙƒÙŠØ¯ Ù†Ù‡Ø§Ø¦ÙŠ: Ø³ÙŠØªÙ… Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!')) {
        return;
      }

      try {
        const snapshot = await getDocs(collection(window.db, 'supervisors'));
        
        const deletePromises = [];
        snapshot.forEach(docSnapshot => {
          deletePromises.push(deleteDoc(doc(window.db, 'supervisors', docSnapshot.id)));
        });

        await Promise.all(deletePromises);
        
        alert('âœ… ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª');
        displaySupervisors();
        updateStats();
      } catch (error) {
        console.error('Error clearing all data:', error);
        alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message);
      }
    }

    function goBackToIndex() {
      window.location.href = 'index.html';
    }

    window.addEventListener('load', () => {
      updateStats();
    });
  </script>
</body>
</html>